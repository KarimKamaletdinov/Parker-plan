@page "/director/"
@using ParkerPlan.Abstractions.Queries
@using ParkerPlan.Abstractions
@using ParkerPlan.Abstractions.Dtos
@inject IQueryHandler<GetWorkers, WorkerDto[]> GetWorkers
@inject IJSRuntime Js


@if (_login != null)
{
    @if (GetWorkers.Execute(new GetWorkers()).Any(x => x.Login == _login))
    {
        @if (_password == GetWorkers.Execute(new GetWorkers()).First(x => x.Login == _login).Password)
        {
            @if (GetWorkers.Execute(new GetWorkers()).First(x => x.Login == _login).Position.ToLower().
                Contains("Директор".ToLower()))
            {
                <DirectorComponent Id="@(GetWorkers.Execute(new GetWorkers()).
                                       First(x => x.Login == _login).Id)"/>
            }
        }
    }
}

@code
{
    private string _login;

    private string _password;

    protected override void OnInitialized()
    {
        ReadCookies();

        base.OnInitialized();
    }


    protected async Task ReadCookies()
    {
        _login = await Js.InvokeAsync<string>("ReadCookie.ReadCookie", "login");
        _password = await Js.InvokeAsync<string>("ReadCookie.ReadCookie", "password");
        StateHasChanged();
    }
}