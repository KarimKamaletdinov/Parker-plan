@using ParkerPlan.Abstractions
@using ParkerPlan.Abstractions.Dtos
@using ParkerPlan.Abstractions.Queries
@inject IQueryHandler<GetWorkers, WorkerDto[]> GetWorkers
@inject IJSRuntime Js
@page "/lead/{Id:int}/full"

@if (_login != null)
{
    @if (GetWorkers.Execute(new GetWorkers()).Any(x => x.Login == _login))
    {
        @if (_password == GetWorkers.Execute(new GetWorkers()).First(x => x.Login == _login).Password)
        {
            <LeadChangeComponent Id="@Id" />
        }
        else
        {
            <MudText Align="Align.Center" Typo="Typo.h3" Color="Color.Error">
                Неверное имя пользователя или пароль!!!
            </MudText>
        }
    }
    else
    {
        <MudText Align="Align.Center" Typo="Typo.h3" Color="Color.Error">
            Неверное имя пользователя или пароль!!!
        </MudText>
    }
}
else
{
    <MudText Align="Align.Center" Typo="Typo.h3">
        Загрузка
    </MudText>

    <MudText Align="Align.Center" Typo="Typo.h3">
        <MudProgressCircular Color="Color.Info" Indeterminate="true" />
    </MudText>
}

@code
{
    [ParameterAttribute]
    public int Id { get; set; }

    private string _login;

    private string _password;

    protected override void OnInitialized()
    {
        ReadCookies();

        base.OnInitialized();
    }


    protected async Task ReadCookies()
    {
        _login = await Js.InvokeAsync<string>("ReadCookie.ReadCookie", "login");
        _password = await Js.InvokeAsync<string>("ReadCookie.ReadCookie", "password");
        StateHasChanged();
    }
}
