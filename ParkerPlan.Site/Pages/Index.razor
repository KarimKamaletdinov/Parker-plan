@page "/"
@page "/admin/{password}"
@using ParkerPlan.Abstractions
@using ParkerPlan.Abstractions.Dtos
@using ParkerPlan.Abstractions.Queries
@using ParkerPlan.Site.Data
@using System.Diagnostics.Eventing.Reader
@inject IQueryHandler<GetGoods, GoodDto[]> GetGoods
@inject PasswordService PasswordService
@inject ISnackbar Snackbar

<MudContainer Class="mt-16 px-8" MaxWidth="MaxWidth.False">
    <MudGrid>
        @foreach (var good in GetGoods.Execute(new GetGoods()))
        {
            <MudItem>
                @{ var url = $"/pen/{good.ParkerId}"; }
                <MudLink Href=@url>
                    <MudPaper Elevation="2" Class="pa-4">
                        @{
                            var name = good.Name;
                            var image = $"pens/PEN{good.ParkerId}.bmp";
                        }
                        <img src=@image>
                        <MudText Typo="Typo.h5" Align="Align.Center">
                            @name
                        </MudText>
                        <MudText Align="Align.Center" Typo="Typo.h6">
                            <MudChip Color="Color.Default">
                                @{ var price = $"{good.Price} руб."; }
                                @price
                            </MudChip>
                        </MudText>
                    </MudPaper>
                </MudLink>
            </MudItem>
        }
    </MudGrid>
</MudContainer>

@if (Password != null)
{
    @if (Password == PasswordService.GetPassword())
    {
        <MudContainer>
            <MudPaper>
                @{
                    var icon = Icons.Material.Rounded.Add;
                }
                <MudButton StartIcon="@icon" OnClick="AddPen">Добавить </MudButton>
            </MudPaper>
        </MudContainer>
    }
    else
    {
        Snackbar.Configuration.PositionClass = Defaults.Classes.Position.BottomRight;
        Snackbar.Add("Неверный пароль!", Severity.Error);
    }
}

<AskIntDialog Visible="@_showDialog" Header="Введите код ручки. Его нельзя будет изменить потом." Ok="@Ok"/>

@code
{
    [ParameterAttribute]
    public string Password { get; set; } = null;

    private bool _showDialog = false;

    private void AddPen()
    {
        _showDialog = true;
    }

    private void Ok()
    {

    }
}
