@page "/basket/"
@using ParkerPlan.QueryHandlers
@using ParkerPlan.Abstractions.Queries
@using ParkerPlan.Abstractions
@using ParkerPlan.Abstractions.Dtos
@using Newtonsoft.Json
@using ParkerPlan.Abstractions.Enums
@using Microsoft.AspNetCore.Http
@inject IQueryHandler<GetCostumers, CostumerDto[]> GetCostumers
@inject IQueryHandler<GetGoods, GoodDto[]> GetGoods
@inject IJSRuntime Js
@inject IHttpContextAccessor Context

<MudButton OnClick="WriteCookies">обновить куки</MudButton>
<MudButton OnClick="ReadCookies">Показать корзину</MudButton>

<MudTable Items="@_pens">
    <HeaderContent>
        <MudTh>Nr</MudTh>
        <MudTh>Sign</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Nr">@context.GoodId</MudTd>
        <MudTd DataLabel="Sign">@context.Count</MudTd>
    </RowTemplate>
</MudTable>



@code
{
    private string JsonBasket { get; set; }

    private GoodLeadDto[] _pens;

    protected async Task WriteCookies()
    {
        await Js.InvokeAsync<object>("WriteCookie.WriteCookie", "basket", "[]",
     DateTime.Now.AddYears(10));
    }
    protected async Task ReadCookies()
    {
        JsonBasket = await Js.InvokeAsync<string>("ReadCookie.ReadCookie", "basket");
        _pens = JsonConvert.DeserializeObject<GoodLeadDto[]>(JsonBasket);
    }

    //protected override void OnInitialized()
    //{
    //    JsonBasket = Context?.HttpContext?.Request.Cookies["basket"];
    //    try
    //    {
    //        _pens = JsonConvert.DeserializeObject<GoodLeadDto[]>(JsonBasket);
    //    }
    //    catch (Exception e)
    //    {
    //        Console.WriteLine(e);
    //    }
    //}
}
