@page "/basket/"
@using ParkerPlan.QueryHandlers
@using ParkerPlan.Abstractions.Queries
@using ParkerPlan.Abstractions
@using ParkerPlan.Abstractions.Dtos
@using Newtonsoft.Json
@using ParkerPlan.Abstractions.Enums
@inject IQueryHandler<GetCostumers, CostumerDto[]> GetCostumers
@inject IQueryHandler<GetGoods, GoodDto[]> GetGoods
@inject IJSRuntime Js

@{
    Goods = JsonConvert.DeserializeObject<GoodLeadDto[]>(JsonBasket);
}

<MudTable Items="@Goods">
    <HeaderContent>
        <MudTh>Nr</MudTh>
        <MudTh>Sign</MudTh>
    </HeaderContent>
    <RowTemplate>
        <MudTd DataLabel="Nr">@context.GoodId</MudTd>
        <MudTd DataLabel="Sign">@context.Count</MudTd>
    </RowTemplate>
</MudTable>



@code
{
    private string JsonBasket { get; set; }

    private GoodLeadDto[] Goods;

    protected async Task WriteCookies(string value)
    {
        await Js.InvokeAsync<object>("WriteCookie.WriteCookie", "basket", value,
     DateTime.Now.AddMinutes(1));
    }
    protected async Task ReadCookies()
    {
        JsonBasket = await Js.InvokeAsync<string>("ReadCookie.ReadCookie", "basket");
    }

    protected override void OnInitialized()
    {
        base.OnInitialized();

        ReadCookies();
    }
}
